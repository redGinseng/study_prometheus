
---

# 프로메테우스 학습 노트 - Chapter 1. What Is Prometheus?

## 목차
- [프로메테우스 소개](#프로메테우스-소개)
- [모니터링이란 무엇인가?](#모니터링이란-무엇인가)
- [모니터링의 분류](#모니터링의-분류)
- [프로메테우스 아키텍처](#프로메테우스-아키텍처)
- [메트릭 유형](#메트릭-유형)
- [알람 설정](#알람-설정)
- [결론 및 추가 자료](#결론-및-추가-자료)


---

## 프로메테우스 소개



Prometheus는 강력한 오픈 소스, 메트릭 기반 모니터링 시스템입니다. 단순하면서도 강력한 데이터 모델과 PromQL 쿼리 언어를 통해 애플리케이션 및 인프라의 성능을 효과적으로 분석합니다.

### 주요 특징 및 이점
- **집중된 기능**: Prometheus는 메트릭 수집과 분석에 특화되어 있습니다.
- **다양한 언어 지원**: Go, Java, Python 등 다양한 프로그래밍 언어에 대한 클라이언트 라이브러리를 제공합니다.
- **풍부한 생태계**: Kubernetes, Docker 등 많은 인기 있는 시스템이 이미 Prometheus로 계측되어 있습니다.
- **확장성**: Prometheus 형식이 아닌 메트릭을 위한 다양한 Exporter들이 존재합니다.

### 데이터 모델 및 쿼리 언어
- **레이블 기반의 데이터 모델**: 각 시계열 데이터는 레이블을 통해 구분되며, 이를 통한 유연한 데이터 집계 및 분석이 가능합니다.
- **PromQL**: 강력한 쿼리 언어를 통해 복잡한 데이터 분석 및 시각화가 가능합니다.

### 알람 및 서비스 발견
- **알람**: PromQL을 사용하여 다양한 조건에 대한 알람을 설정할 수 있습니다.
- **자동 서비스 발견**: Kubernetes, EC2 등에서 자동으로 서비스를 발견하고 메트릭을 수집합니다.

---
## 모니터링이란 무엇인가?

모니터링의 정의는 다양하며, 사람에 따라 그 의미가 달라질 수 있습니다. 프로메테우스는 소프트웨어 개발자와 관리자가 생산 컴퓨터 시스템(예: 애플리케이션, 도구, 데이터베이스, 네트워크)을 운영하는 데 도움을 주기 위해 만들어진 시스템입니다. 이러한 맥락에서 모니터링은 다음 네 가지 주요 요소로 좁혀볼 수 있습니다:

### 1. 경고 (Alerting)
- 모니터링의 가장 중요한 목적은 문제가 발생했을 때 인지하고, 인간의 개입을 요구하는 것입니다.
- 모니터링 시스템은 문제 발생 시 경고를 발생시켜 적절한 대응을 유도합니다.

### 2. 디버깅 (Debugging)
- 문제가 발생했을 때, 원인을 조사하고 해결하는 과정입니다.
- 경고로 인해 개입한 사람은 문제의 근본 원인을 파악하고 해결해야 합니다.

### 3. 추세 분석 (Trending)
- 경고와 디버깅은 몇 분에서 몇 시간의 단기간에 집중되지만, 시스템의 사용 및 변화 추세를 장기간 관찰하는 것도 중요합니다.
- 추세 분석은 설계 결정이나 용량 계획과 같은 프로세스에 유용한 정보를 제공합니다.

### 4. 플러밍 (Plumbing)
- 모니터링 시스템은 근본적으로 데이터 처리 파이프라인입니다.
- 때로는 모니터링 시스템의 일부를 다른 목적에 사용하는 것이 맞춤형 솔루션을 구축하는 것보다 편리할 수 있습니다.

이러한 다양한 요소를 통해 모니터링의 개념을 이해하고, 다른 사람들이 모니터링에 대해 어떻게 생각하는지 이해하는 데 도움이 됩니다. 모니터링의 역사를 조금 살펴보는 것도 이러한 관점을 이해하는 데 유용할 수 있습니다.

---

## 모니터링의 분류

모니터링의 핵심은 대부분 '이벤트'에 관한 것입니다. 이벤트는 HTTP 요청 수신, 함수 진입, 사용자 로그인, 디스크 데이터 쓰기 등 다양한 형태가 될 수 있습니다. 각 이벤트는 상황에 따른 맥락을 가지며, 이 정보는 디버깅과 시스템 이해에 중요합니다. 하지만 모든 이벤트와 맥락을 처리하고 저장하는 것은 실용적이지 않습니다. 그래서 데이터 양을 줄이는 네 가지 접근 방식이 있습니다

### 프로파일링 (Profiling)
- 모든 이벤트에 대한 모든 맥락을 항상 가질 수는 없지만, 제한된 시간 동안 일부 맥락을 가질 수 있습니다.
- 예를 들어, Tcpdump는 네트워크 트래픽을 기록하는 프로파일링 도구입니다.
- Linux 커널에서 eBPF는 커널 이벤트의 상세한 프로파일링을 허용합니다.

### 트레이싱 (Tracing)
- 모든 이벤트를 살펴보는 것이 아니라 관심 있는 함수를 통과하는 이벤트의 일부를 샘플링합니다.
- 분산 트레이싱은 프로세스 간 트레이싱을 가능하게 하여, 마이크로서비스 아키텍처 디버깅에 필수적입니다.

### 로깅 (Logging)
- 제한된 이벤트 세트를 기록하고, 각 이벤트에 대한 일부 맥락을 기록합니다.
- 로그의 유형에 따라 다양한 용도, 내구성 및 보존 요구 사항이 있습니다.

### 메트릭스 (Metrics)
- 맥락을 대부분 무시하고, 시간에 따른 다양한 유형의 이벤트에 대한 집계를 추적합니다.
- 메트릭스는 시스템의 전반적인 건강, 행동 및 성능을 추적하는 데 적합합니다.

---
## 프로메테우스 아키텍처

### 아키텍처 개요
- **서비스 발견**: Prometheus는 서비스 발견을 통해 스크레이핑할 대상을 찾습니다. 이는 자체 계측된 애플리케이션 또는 Exporter를 통해 스크레이핑할 수 있는 타사 애플리케이션을 포함합니다.
- **데이터 저장**: 스크레이핑된 데이터는 저장되며, PromQL을 사용하여 대시보드에서 사용되거나 Alertmanager로 경고를 보낼 수 있습니다.

### 클라이언트 라이브러리
- **계측의 중요성**: 메트릭은 자동으로 생성되지 않으며, 클라이언트 라이브러리를 통해 계측이 이루어져야 합니다.
- **언어 지원**: Prometheus는 Go, Python, Java 등 여러 주요 언어와 런타임을 위한 공식 및 비공식 클라이언트 라이브러리를 제공합니다.

### Exporter
- **제한된 코드의 계측**: 모든 코드에 직접 계측을 추가할 수 없는 경우, Exporter를 사용하여 메트릭을 Prometheus 형식으로 변환합니다.

- **기존 시스템과의 호환성**: 많은 시스템과 애플리케이션이 Prometheus 형식으로 직접 메트릭을 내보내지 않습니다. Exporter는 이러한 시스템에서 메트릭을 수집하고 Prometheus가 이해할 수 있는 형식으로 변환합니다.
- **메트릭 수집 및 변환**:Exporter는 다양한 소스에서 메트릭을 수집합니다. 이는 데이터베이스, 하드웨어 장치, 서드파티 서비스 등 다양한 것을 포함할 수 있습니다. 수집된 데이터는 Prometheus가 사용할 수 있는 형식으로 변환됩니다.
- **Prometheus와의 통합**:Exporter는 Prometheus가 '풀' 방식으로 메트릭을 수집할 수 있도록 HTTP 엔드포인트를 제공합니다. Prometheus 서버는 이 엔드포인트에 주기적으로 요청을 보내 메트릭을 수집합니다.
- **다양한 유형의 Exporter**:일반적인 사용 사례에 맞춘 다양한 Exporter가 존재합니다. 예를 들어, Node Exporter는 시스템 레벨의 메트릭을 수집하고, MySQL Exporter는 MySQL 데이터베이스의 메트릭을 수집합니다.
- **설정 및 유연성**:대부분의 Exporter는 구성 가능하며, 수집할 메트릭의 종류나 세부 사항을 조정할 수 있습니다. 이를 통해 특정 환경에 맞는 메트릭 수집이 가능합니다.


### 서비스 발견
- **동적 환경 대응**: 서비스 발견을 통해 동적 환경에서 실행되는 애플리케이션과 기계를 파악하고 스크레이핑 대상을 결정합니다.

### 스크레이핑
- **데이터 수집 방식**: Prometheus는 정기적으로 HTTP 요청을 보내어 메트릭을 수집합니다. 이를 스크레이핑이라고 합니다.

### 저장
- **데이터 저장소**: Prometheus는 데이터를 로컬 데이터베이스에 저장합니다. 이 시스템은 클러스터링을 지원하지 않으며, 신뢰성과 운영의 간편함에 중점을 둡니다.

### 대시보드 및 경고
- **PromQL과 대시보드**: PromQL을 사용하여 대시보드와 그래프를 생성할 수 있습니다. Grafana와 같은 도구를 사용하여 보다 고급 대시보드를 구성할 수 있습니다.
- **경고 관리**: 경고는 PromQL을 기반으로 정의되며, Alertmanager로 전송되어 처리됩니다.

### 장기 저장
- **리모트 저장**: Prometheus는 로컬 저장에 제한되어 있으나, 리모트 읽기 및 쓰기 API를 통해 다른 시스템과 통합할 수 있습니다.

### Prometheus의 한계
- **적합하지 않은 사용 사례**: 이벤트 로그나 개별 이벤트 저장, 고기능성 데이터(예: 이메일 주소, 사용자 이름)에는 적합하지 않습니다.

---
Quiz.

프로메테우스의 핵심 기능은 무엇인가요?

답변: B) 메트릭 기반 모니터링
평가: 정확합니다! 프로메테우스는 메트릭 기반 모니터링 시스템으로, 시스템과 애플리케이션의 성능을 모니터링하는 데 사용됩니다.
프로파일링과 트레이싱의 차이점은 무엇인가요?

평가: 프로파일링은 시스템이나 애플리케이션의 성능을 분석하는 데 사용되며, 제한된 기간 동안 성능 데이터를 수집합니다. 반면 트레이싱은 특정 이벤트나 함수를 통과하는 작업의 흐름을 추적하고, 이러한 함수의 실행 시간과 순서를 기록합니다.
PromQL은 무엇에 사용되나요?

답변: C) 쿼리 및 데이터 분석
평가: 맞습니다! PromQL은 Prometheus Query Language의 약자로, Prometheus에서 데이터를 쿼리하고 분석하는 데 사용됩니다.
프로메테우스에서 '레이블'이란 무엇을 의미하나요?

답변: 프로메테우스에서의 메트릭은 컨텍스트를 가지며, 레이블을 통해 이를 표현합니다.
평가: 정확한 설명입니다! 레이블은 프로메테우스 메트릭에 추가적인 컨텍스트 정보를 제공하여, 메트릭을 더 상세하게 분류하고 구분할 수 있게 해줍니다.
알람 설정을 위해 프로메테우스에서 사용하는 파일은 무엇인가요?

답변: alertmanager.yml, rules.yml
평가: 거의 맞습니다만, 알람 규칙은 rules.yml 파일에 정의되며, alertmanager.yml은 Alertmanager의 구성 파일입니다.
프로메테우스가 클러스터링을 지원하지 않는 이유는 무엇인가요?

평가: 프로메테우스는 단일 서버로 운영되도록 설계되었으며, 이는 신뢰성과 단순성을 유지하기 위한 선택입니다. 분산 시스템은 복잡하고 오류가 발생하기 쉬우며, 프로메테우스는 이러한 복잡성을 피하고자 합니다.


질문 1
프로메테우스의 메트릭 수집 방식은 주로 어떻게 이루어지나요?

A) 에이전트가 서버로 데이터를 푸시한다.
B) 서버가 에이전트로부터 데이터를 풀한다.
C) 사용자가 수동으로 데이터를 업로드한다.
D) 외부 API를 통해 데이터를 가져온다.


답변: B) 서버가 에이전트로부터 데이터를 풀한다.
설명: 프로메테우스는 주로 '풀' 모델을 사용하여, 서버가 정기적으로 에이전트나 서비스로부터 메트릭을 수집합니다.


질문 2
프로메테우스에서 'Exporter'의 주요 역할은 무엇인가요?

A) 데이터를 저장하기 위한 데이터베이스를 제공한다.
B) 경고 메시지를 사용자에게 전송한다.
C) Prometheus 형식이 아닌 메트릭을 변환한다.
D) 새로운 메트릭 유형을 정의한다.

답변: C) Prometheus 형식이 아닌 메트릭을 변환한다.
설명: Exporter는 Prometheus가 이해할 수 있는 형식으로 기존 메트릭을 변환하는 역할을 합니다. 이는 다양한 시스템과 서비스의 메트릭을 Prometheus에서 모니터링할 수 있게 해줍니다.

질문 3
프로메테우스의 데이터 모델에서 '레이블'의 주된 용도는 무엇인가요?

A) 데이터 저장의 압축을 위한 것이다.
B) 데이터 보안을 강화한다.
C) 메트릭에 대한 추가적인 정보를 제공한다.
D) 사용자 인터페이스를 개선한다.

답변: C) 메트릭에 대한 추가적인 정보를 제공한다.
설명: 레이블은 메트릭에 대한 추가적인 컨텍스트를 제공하여, 데이터를 더 세분화하고 유연하게 쿼리할 수 있게 합니다.

질문 4
프로메테우스가 클러스터링을 지원하지 않는 주된 이유는 무엇인가요?

A) 클러스터링은 너무 많은 리소스를 소모한다.
B) 클러스터링은 데이터의 신뢰성을 저하시킨다.
C) 단순성과 신뢰성을 유지하기 위해서이다.
D) 클러스터링 기능이 아직 개발 중이다.

답변: C) 단순성과 신뢰성을 유지하기 위해서이다.
설명: 프로메테우스는 단일 서버 기반으로 설계되어 있으며, 이는 시스템의 복잡성을 줄이고 신뢰성을 높이기 위한 의도적인 선택입니다.

질문 5
PromQL의 주요 사용 목적은 무엇인가요?

A) 데이터 저장 형식을 설정한다.
B) 메트릭 데이터를 쿼리하고 분석한다.
C) 사용자 인터페이스를 구성한다.
D) 네트워크 설정을 관리한다.


훌륭합니다! 답변을 확인해 보겠습니다.

퀴즈 답안 확인
프로메테우스의 메트릭 수집 방식

답변: B) 서버가 에이전트로부터 데이터를 풀한다.
설명: 프로메테우스는 주로 '풀' 모델을 사용하여, 서버가 정기적으로 에이전트나 서비스로부터 메트릭을 수집합니다.
'Exporter'의 주요 역할

답변: C) Prometheus 형식이 아닌 메트릭을 변환한다.
설명: Exporter는 Prometheus가 이해할 수 있는 형식으로 기존 메트릭을 변환하는 역할을 합니다. 이는 다양한 시스템과 서비스의 메트릭을 Prometheus에서 모니터링할 수 있게 해줍니다.
프로메테우스 데이터 모델에서 '레이블'의 용도

답변: C) 메트릭에 대한 추가적인 정보를 제공한다.
설명: 레이블은 메트릭에 대한 추가적인 컨텍스트를 제공하여, 데이터를 더 세분화하고 유연하게 쿼리할 수 있게 합니다.
프로메테우스가 클러스터링을 지원하지 않는 이유

답변: C) 단순성과 신뢰성을 유지하기 위해서이다.
설명: 프로메테우스는 단일 서버 기반으로 설계되어 있으며, 이는 시스템의 복잡성을 줄이고 신뢰성을 높이기 위한 의도적인 선택입니다.
PromQL의 주요 사용 목적

답변: B) 메트릭 데이터를 쿼리하고 분석한다.
설명: PromQL은 Prometheus Query Language로, Prometheus에서 저장된 메트릭 데이터를 효과적으로 쿼리하고 분석하는 데 사용됩니다.
모든 답변이 정확합니다! 이 퀴즈를 통해 프로메테우스에 대한 깊은 이해를 보여주셨습니다. 프로메테우스는 복잡한 시스템과 애플리케이션의 모니터링을 효과적으로 수행하는 데 매우 유용한 도구입니다.


---
## 메트릭 유형
프로메테우스에서 주로 사용되는 두 가지 메트릭 유형은 다음과 같습니다:
- **게이지 (Gauge)**: 현재의 값을 나타내며, 값이 증가하거나 감소할 수 있습니다.
- **카운터 (Counter)**: 누적된 값을 나타내며, 값은 오직 증가만 합니다.

---

## 알람 설정
알람을 설정하기 위해서는 `rule.yaml` 파일에 알람 규칙을 정의하고, Prometheus 구성 파일에서 이 파일을 참조해야 합니다.
``